<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ruleta</title>
  <link rel="stylesheet" href="/css/roulette.css">
</head>
<body>
  <div class="roulette-container">
    <div class="wheel-wrapper">
      <div class="pointer"></div>
      <div class="wheel" id="wheel">
        <% premios = [
          "Premio 1", "Premio 2", "Premio 3", "Premio 4", "Premio 5",
          "Premio 6", "Nada", "Premio 7", "Premio 8", "Premio 9", "Premio 10"
        ] %>
        <% premios.each_with_index do |premio, i| %>
          <div class="label" style="--i: <%= i %>;"><%= premio %></div>
        <% end %>
      </div>
    </div>

    <form id="roulette-form" action="/roulette" method="POST">
      <input type="hidden" name="premio_id" id="premio_id_input">
      <button type="button" class="start-button">Girar</button>
    </form>
  </div>

  <script>
    const startButton = document.querySelector('.start-button');
    const wheel = document.getElementById('wheel');
    const totalItems = 11;

    startButton.addEventListener('click', () => {
      const selectedIndex = Math.floor(Math.random() * totalItems);
      const degreesPerItem = 360 / totalItems;
      const stopAngle = selectedIndex * degreesPerItem;
      const extraSpins = 360 * 5;
      const totalRotation = extraSpins + stopAngle;

      wheel.style.transition = 'transform 4s ease-out';
      wheel.style.transform = `rotate(-${totalRotation}deg)`;

      setTimeout(() => {
        document.getElementById('premio_id_input').value = selectedIndex;
        document.getElementById('roulette-form').submit();
      }, 4000);
    });
  </script>
</body>
</html>
